<!-- 修改基地资讯 -->
<!DOCTYPE html>
<html class="x-admin-sm">
    <head>
        <meta charset="UTF-8">
        <title>prp-management</title>
        <meta name="renderer" content="webkit">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta name="viewport" content="width=device-width,user-scalable=yes, minimum-scale=0.4, initial-scale=0.8,target-densitydpi=low-dpi" />
        <link rel="stylesheet" href="static/css/font.css">
        <link rel="stylesheet" href="static/css/xadmin.css">
        <link rel="stylesheet" href="static/css/basePhoto.css">
        
        <!--[if lt IE 9]>
          <script src="https://cdn.staticfile.org/html5shiv/r29/html5.min.js"></script>
          <script src="https://cdn.staticfile.org/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->
    </head>
    <body>
        <div class="x-nav">
          <span class="layui-breadcrumb">
            <a href="">首页</a>
            <a href="">演示</a>
            <a>
              <cite>导航元素</cite></a>
          </span>
          <a class="layui-btn layui-btn-small" style="line-height:1.6em;margin-top:3px;float:right" onclick="location.reload()" title="刷新">
            <i class="layui-icon layui-icon-refresh" style="line-height:30px"></i></a>
        </div>
        <div class="layui-fluid">
            <div class="layui-row layui-col-space15">
                <div class="layui-col-md12">
                    <div class="layui-card">
                        
                        
                        <div class="layui-card-body layui-table-body layui-table-main" style="overflow: hidden;">
                            <form class="layui-form">
                                <div class="contain" >
                                    <div class="layui-form-item">
                                        <label for="bm_title" class="layui-form-label">
                                            <span class="x-red">*</span>资&nbsp;讯&nbsp;标&nbsp;题：
                                        </label>
                                        <div class="layui-input-inline">
                                            <input type="text" id="bm_title" name="bm_title" required="required"  autocomplete="off" class="layui-input">
                                        </div>
                                    </div>
                                    <div class="layui-form-item">
                                        <label for="bm_author" class="layui-form-label">
                                            <span class="x-red">*</span>资&nbsp;讯&nbsp;作&nbsp;者：
                                        </label>
                                        <div class="layui-input-inline">
                                            <input type="text" id="bm_author" name="bm_author" required="required"  autocomplete="off" class="layui-input">
                                        </div>
                                    </div>

                                    <div class="layui-form-item">
                                        <label for="bm_detail" class="layui-form-label">
                                            <span class="x-red">*</span>资&nbsp;讯&nbsp;内&nbsp;容：
                                        </label>
                                        <div class="layui-input-inline">
                                            <textarea placeholder="请输入内容" class="layui-textarea" id="bm_detail" name="bm_detail" required="required" "></textarea>
                                        </div>
                                    </div>

                                    <div class="layui-form-item">
                                        <label for="bm_createtime" class="layui-form-label">
                                            <span class="x-red">*</span>创&nbsp;建&nbsp;时&nbsp;间：
                                        </label>
                                        <div class="layui-input-inline">
                                            <input type="text" id="bm_createtime" name="bm_createtime" required="required" autocomplete="off" class="layui-input" disabled>
                                        </div>
                                    </div>

                                    

                                <!-- 资讯图片 -->
                                <div class="layui-form-item" >
                                    <label for="L_username" class="layui-form-label">
                                        <span class="x-red">*</span>资&nbsp;讯&nbsp;图&nbsp;片：
                                    </label>

                                    <div class="layui-input-inline">
                                        <div class="profile-photo baseImg" style="float: left;position: absolute;left: 0px;width: 100px;height: 100px;">
                                            <div class="photo-amend" style="width: 100px;height: 100px;display: block;">
                                                <!-- <img src="static/img/下载.jpg" alt=""> -->
                                                <div class="photo-mask"></div>
                                                <div class="amend-content">
                                                    <p class="amend" style="margin-bottom: 10px;">修改资讯图片</p>
                                                    <i class="layui-icon" style="font-size: 40px;">&#xe65d;</i>   
                                                </div>
                                                <input type="file" name="file" onchange="imgChange(this)" class="Select-file" id="imgInput"/>
                                            </div>
                                        </div>
                                    </div>

                                </div>       

                                <!-- 修改 -->
                                <div class="layui-form-item" style="margin-top: 136px;margin-left: 152px;">
                                    <label for="L_repass" class="layui-form-label"></label>
                                    <button class="layui-btn" lay-filter="change" lay-submit="" type="button">修改</button>
                                </div>

                            </form>

                        </div>
                       
                    </div>
                </div>
            </div>
        </div> 
    </body>
    <script src="static/js/jquery.min.js"></script>
    <script src="static/js/jquery-1.12.4.min.js"></script>
    <script src="static/lib/layui/layui.js" charset="utf-8"></script>
    <script type="text/javascript" src="static/js/xadmin.js"></script>

    <script src="static/js/baseMessage.js"></script>

    <!-- <script src="static/js/baseMessageDe.js"></script> -->
    <script src="static/js/baseMessagePhoto.js"></script>
    

    <script src="static/js/formateDate.js"></script>
    <script src="static/js/cookieUtil.js"></script>

    <script src="static/js/jquery.cookie.js"></script>

    <script>
        var message = JSON.parse(getCookie("message"));
        var bm_createtime = formatDate(message.bm_createtime);

        // 信息展示

        $("#bm_title").val(message.bm_title);
        $("#bm_author").val(message.bm_author);
        $("#bm_detail").val(message.bm_detail);
        $("#bm_createtime").val(bm_createtime);

        // 头像
        var str = "";
        str += 
        `
        <img src="${message.bm_image}" alt="" id="bm_image">
        `
        $(".photo-mask").before(str);

        // 鼠标在不同的图片上移入移出
        $(".profile-photo").mouseenter(function(obj) {
            $(".amend-content").fadeIn(200);
        });
        
        $(".profile-photo").mouseleave(function(obj) {
                $(".amend-content").fadeOut(200);
        });
    
        layui.use(['form', 'layer'],
            function() {
                $ = layui.jquery;
                var form = layui.form,
                layer = layui.layer;

                // 表单提交
                form.on('submit(change)',
                    function(data) {
                        var bm_title = $("#bm_title").val();
                        var bm_author = $("#bm_author").val();
                        var bm_detail = $("#bm_detail").val();

                        var myJson = JSON.stringify({"base_id": getCookie("base_id"),"bm_title":bm_title,"bm_author":bm_author,"bm_detail":bm_detail,"bm_id":message.bm_id});
                        $.ajax({
                            url: MyPathConfig("changeBasesMessagesById"),
                            type:"post",
                            contentType:"application/json;charset=utf-8",  //注意，这里是json格式
                            data : myJson,
                            success(res){
                                if(res.code == 200){
                                    layer.alert("修改成功", {
                                        icon: 1
                                    },
                                    function(){
                                        message.bm_title = bm_title;
                                        message.bm_author = bm_author;
                                        message.bm_detail = bm_detail;
                                        setCookie("message",JSON.stringify(message));

                                        var index = parent.layer.getFrameIndex(window.name);
                                        // layer.close(layer.index); 
                                        //关闭当前frame
                                        parent.layer.close(index);
                                        // 获得frame索引
                                        parent.location.reload();
                                    })
                                    return false;
                                    
                                }else if(res.code == 404){
                                    error404();
                                }
                                else{
                                    layer.alert(res.message, {
                                        icon: 5
                                    },
                                    function(){
                                        // 获得frame索引
                                        var index = parent.layer.getFrameIndex(window.name);
                                        // layer.close(layer.index); 
                                        //关闭当前frame
                                        parent.layer.close(index);  
                                    })
                                    
                                    return false;
                                }
                            },
                            error(error) {
                                error500();
                            }
                        })
                })
        })
        
    

    </script>


</html>